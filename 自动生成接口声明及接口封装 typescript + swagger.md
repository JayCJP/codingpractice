
>ğŸ’¡æ ¹æ® [é—å¿˜æ›²çº¿](https://baike.baidu.com/item/%E9%81%97%E5%BF%98%E6%9B%B2%E7%BA%BF/7278665?fr=aladdin)ï¼šå¦‚æœæ²¡æœ‰è®°å½•å’Œå›é¡¾ï¼Œ6å¤©åä¾¿ä¼šå¿˜è®°75%çš„å†…å®¹<br />      è¯»ä¹¦ç¬”è®°æ­£æ˜¯å¸®åŠ©ä½ è®°å½•å’Œå›é¡¾çš„å·¥å…·ï¼Œä¸å¿…æ‹˜æ³¥äºå½¢å¼ï¼Œå…¶æ ¸å¿ƒæ˜¯ï¼šè®°å½•ã€ç¿»çœ‹ã€æ€è€ƒ

<a name="HP1DO"></a>
## æœ¬æ–‡å¹²è´§

- pont-engine ä½¿ç”¨ä»‹ç»
- è§£æ swagger è‡ªåŠ¨ç”Ÿæˆ æ¥å£å“åº”ä½“ å£°æ˜æ–‡ä»¶
- è‡ªå®šä¹‰ä»£ç ç‰‡æ®µ é«˜åº¦è‡ªç”±å°è£…
- è‡ªåŠ¨å¯¼å‡º api æ¨¡å—æä¾›å…¨å±€è°ƒç”¨
- è‡ªåŠ¨ç”Ÿæˆæ¥å£æ³¨é‡Š

<a name="YRys8"></a>
## å‰è¨€

æœ€è¿‘åœ¨æ—¥å¸¸çš„å¼€å‘å·¥ä½œä¸­ï¼Œå‘ç°äº†ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯åœ¨å¯¹æ¥åç«¯çš„æ¥å£æ—¶ï¼Œå‘ç°ç»å¸¸è¦å»ç¿»é˜…æ¥å£æ–‡æ¡£ï¼ŒæŸ¥åˆ°å¯¹åº”çš„æ¥å£ä»¥åŠè¿”å›å€¼ã€‚è¿™ä¸ªæ“ä½œçœ‹ä¸Šå»å¾ˆæ­£å¸¸æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯æ²¡æœ‰ä»£ç æç¤ºç¡®å®ä¸æ˜¯å¾ˆæ–¹ä¾¿ã€‚éœ€è¦åœ¨æµè§ˆå™¨è¯·æ±‚ä¸­æŸ¥çœ‹è¿”å›å€¼

é€šå¸¸åœ¨é¡¹ç›®çš„è®¾è®¡ä¸­éƒ½ä¼šå¯¹æ¥å£è¯·æ±‚åšä¸€ä¸ªå°è£…å¤„ç†ï¼Œç›®çš„å°±æ˜¯ç»Ÿä¸€è§„èŒƒï¼Œç»Ÿä¸€ç®¡ç†ç»´æŠ¤ï¼Œæ–¹ä¾¿æ‹“å±•å’Œè¿­ä»£ã€‚å¸¸è§çš„å°±æ˜¯åœ¨é¡¹ç›®çš„ src/api æ–‡ä»¶å¤¹ä¸­ æ·»åŠ æ¥å£é…ç½®æ–‡ä»¶ ä»¥åŠæŒ‰æ¨¡å—æ·»åŠ æ¥å£çš„å°è£…

å¦‚ä¸‹é¢è¿™ä¸ªç®€å•çš„å®ç°ï¼Œ å½“ä½ åœ¨ä¸šåŠ¡ä¸­æƒ³è¦è¯·æ±‚ä¸€ä¸ª page åˆ—è¡¨çš„æ—¶å€™ï¼Œéœ€è¦è‡ªå·±å®šä¹‰è¯·æ±‚å‚æ•°çš„ç±»å‹ä»¥åŠæ¥å£å“åº”çš„ç±»å‹ã€‚è‡ªå·±æ‰‹å†™ç±»å‹è¿™ä¸ªè¿‡ç¨‹å°±ä¼šæ˜¾å¾—å¾ˆç¹çä¸”éå¸¸è€—æ—¶ã€‚å¦‚æœæ¥å£å¤šçš„æ—¶å€™é‚£ç®€ç›´å°±æ˜¯ç¾éš¾ï¼Œæœ‰æ²¡æœ‰ä¸€ç§å·¥å…·å¯ä»¥è‡ªåŠ¨å¸®æˆ‘ä»¬æ¥å®Œæˆæ¥å£çš„ç±»å‹ç¼–å†™ è¿™ä»¶äº‹å‘¢ï¼Ÿ æ¥ä¸‹æ¥ç»™å¤§å®¶ç®€å•ä»‹ç»ä¸€ä¸‹   é˜¿é‡Œå¼€æºçš„å·¥å…·  Pont å¯ä»¥æ¥å¸®æˆ‘ä»¬å®Œæˆè¿™ä»¶äº‹æƒ…ï¼Œå¤§å¤§èŠ‚çœäº†å¯¹æ¥æ¥å£çš„æ—¶é—´ã€‚

```typescript
// src/api/http.ts  å…¬å…±çš„ http è¯·æ±‚ axios å°è£…
class Http {
  // è¯·æ±‚ç±»å‹
  post<T, U>(url: string, data: U, config?: AxiosRequestConfig) {
    return this.handleResponse<T>({
      url: url,
      method: 'POST',
      data: data,
      ...config
    })
  }
  get<T, U>(url: string, data: U, config?: AxiosRequestConfig): Promise<T>
  // è¯·æ±‚æ–¹æ³•
  handleResponse<T>(config: AxiosRequestConfig): Promise<T>
}
  
  const httpReq = new Http({
    timeout: 5000
  })
  
  // è¯·æ±‚æ–¹å¼å°è£… (T å®šä¹‰æ¥å£æ”¾å›çš„æ•°æ®å®ä½“, U å®šä¹‰æ¥å£å…¥å‚çš„ç»“æ„)
  export function post<T, U>(url: string, data: U, config?: AxiosRequestConfig) {
    return httpReq.post<T, U>(url, data, config)
  }

// ----------------------  åˆ†å‰²çº¿ ----------------------------- //

// src/api/mods/xxx.ts  å°è£…æ¥å£å¯¹åº”çš„æ–¹æ³•

interface getPageParams {
  page: number
  size: number
}
interface Item {
  id: number
  title: string
}
// è·å–åˆ—è¡¨
export function getPage(data: getPageParams) {
  return post<Item[], getPageParams>('/api/getpage', data)
}

```

<a name="mZ5VA"></a>
## Pont é“¾æ¥å‰åç«¯

pont åœ¨æ³•è¯­ä¸­æ˜¯â€œæ¡¥â€çš„æ„æ€ï¼Œå¯“æ„ç€å‰åç«¯ä¹‹é—´çš„æ¡¥æ¢ã€‚Pont æŠŠ swaggerã€rapã€dip ç­‰å¤šç§æ¥å£æ–‡æ¡£å¹³å°ï¼Œè½¬æ¢æˆ Pont å…ƒæ•°æ®ã€‚Pont åˆ©ç”¨æ¥å£å…ƒæ•°æ®ï¼Œå¯ä»¥é«˜åº¦å®šåˆ¶åŒ–ç”Ÿæˆå‰ç«¯æ¥å£å±‚ä»£ç ï¼Œæ¥å£ mock å¹³å°å’Œæ¥å£æµ‹è¯•å¹³å°ã€‚å…¶ä¸­ swagger æ•°æ®æºï¼ŒPont å·²ç»å®Œç¾æ”¯æŒã€‚å¹¶åœ¨ä¸€äº›å¤§å‹é¡¹ç›®ä¸­ä½¿ç”¨äº†è¿‘ä¸¤å¹´ï¼Œå„ç§é«˜åº¦å®šåˆ¶åŒ–éœ€æ±‚éƒ½å¯ä»¥æ»¡è¶³ã€‚

ç®€å•çš„æ¥è¯´ å°±æ˜¯é€šè¿‡è§£æ swagger çš„ json æ•°æ®ï¼Œè·å–åˆ°æ¥å£çš„åœ°å€ã€å…¥å‚å’Œè¿”å›å€¼ï¼Œä»è€Œæ ¹æ®è¿™äº›å‚æ•° ç”Ÿæˆè‡ªå®šä¹‰çš„ä»£ç å°è£…ã€‚æœ‰ç‚¹æ„æ€â€¦

æ—¢ç„¶å®˜æ–¹ä»‹ç»å¾—è¿™ä¹ˆå¼ºå¤§ï¼Œ é‚£æˆ‘ä»¬æ¥çœ‹çœ‹æ€ä¹ˆè§£å†³å‰è¨€ä¸­æåˆ°çš„é—®é¢˜ï¼Œæœ¬æ–‡ç»™å¤§å®¶ä»‹ç»åœ¨ vue ä¸­çš„å®è·µï¼Œåœ¨æ­¤ä¹‹å‰å»ºè®®å…ˆç®€å•è¿‡ä¸€ä¸‹å®˜æ–¹ä»‹ç»æ–‡æ¡£ã€‚

GitHubåœ°å€ï¼š[https://github.com/alibaba/pont](https://github.com/alibaba/pont)

ç¤ºä¾‹ï¼š[https://github.com/alibaba/pont/tree/master/examples](https://github.com/alibaba/pont/tree/master/examples)ï¼ˆå®˜æ–¹åªæœ‰ react ç‰ˆæœ¬ï¼‰

<a name="z7syQ"></a>
## å¸Œæœ›å®ƒèƒ½ç»™æˆ‘ä»¬è§£å†³

- è‡ªåŠ¨ç”Ÿæˆæ¥å£å£°æ˜æ–‡ä»¶
- è‡ªåŠ¨ç”Ÿæˆæ¥å£å°è£…ä»£ç 
- è‡ªåŠ¨ç”Ÿæˆæ¥å£æ•°æ®çš„åŸºç±»
- è‡ªåŠ¨ç”Ÿæˆæ¥å£ä»£ç æ³¨é‡Š
- yarn apis è‡ªåŠ¨è¾“å‡ºæ–‡ä»¶

<a name="QE7no"></a>
## é‚£å¼€å§‹å§

1. æ‰¾ä¸€ä¸ª swagger æ¥å£æ–‡æ¡£ ï¼Œæ³¨æ„ pont åªæ”¯æŒ swagger 2 ä»¥ä¸Šçš„ç‰ˆæœ¬
2. åœ¨é¡¹ç›®çš„æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ª `pont-config.json`æ–‡ä»¶
3. åˆ›å»ºä¸€ä¸ªç›®å½• `pontConfig` 
4. åˆ›å»ºä¸¤ä¸ªæ–‡ä»¶åˆ° `pontTemplate.ts` `transformPath.ts` åˆ°  `pontConfig` 
5. å…¨å±€å®‰è£… pont-engine

<a name="mwJ5l"></a>
### åˆå§‹é…ç½®æ–‡ä»¶

1. **originUrl**ï¼šæ¥å£å¹³å°æä¾›çš„æ•°æ®æºï¼ˆè¿æ¥ä¸€èˆ¬åœ¨swagger æ ‡é¢˜ä¸‹é¢ï¼‰
1. **templatePath**ï¼šè‡ªå®šä¹‰ç”Ÿæˆä»£ç æ¨¡ç‰ˆçš„æ–‡ä»¶
1. **transformPath**ï¼šå¯ä»¥å¯¹swaggeræ•°æ®æºé¢„å¤„ç†
1. **outDir**ï¼šæ–‡ä»¶å¯¼å‡ºçš„ç›®å½•
1. **prettierConfig**ï¼šå–œé—»ä¹è§çš„ ä»£ç æ ¼å¼åŒ–é…ç½®
1. **templateType**ï¼šå®˜æ–¹æä¾›äº† fetch å’Œ hook çš„ä»£ç ç”Ÿæˆæ¨¡æ¿ï¼Œä½†è¿™é‡Œæˆ‘ä»¬é€‰æ‹©è‡ªå·±ç”Ÿæˆ
1. **mocks**ï¼šå–œé—»ä¹è§çš„ mocks æ•°æ®

å®˜æ–¹æœ‰éå¸¸è¯¦ç»†çš„ä»‹ç» æ›´å¤šå­—æ®µè§£é‡Š-> [ä¼ é€é—¨](https://github.com/alibaba/pont/blob/master/docs/pontConfig.md)

`pont-config.json` æ·»åŠ ä¸‹é¢çš„ä¿¡æ¯

```json
{
  "originUrl": "/path/to/swagger.json",
  "templateType": "fetch",
  "templatePath": "./pontConfig/pontTemplate",
  "transformPath": "./pontConfig/transformPath",
  "outDir": "./src/api",
  "mocks": {
    "enable": false
  },
  "prettierConfig": {
    "tabWidth": 2,
    "semi": false,
    "singleQuote": true,
    "bracketSpacing": true,
    "arrowParens": "avoid",
    "trailingComma": "none",
    "proseWrap": "never",
    "printWidth": 300,
    "htmlWhitespaceSensitivity": "ignore",
    "endOfLine": "auto"
  }
}
```

<a name="ZKPaZ"></a>
### è‡ªå®šä¹‰è§£æ swagger çš„æ¥å£æ•°æ®

å½“æˆ‘ä»¬æ‹¿åˆ°åç«¯çš„ swagger é“¾æ¥æ—¶ï¼Œä¸€èˆ¬æ˜¯åŒ…å«æ•´ä¸ªé¡¹ç›®çš„æ¥å£ã€‚å¯èƒ½æœ‰å‰å°çš„åå°çš„ï¼Œå¦‚æœä¸€é”®ç”Ÿæˆå°±åŒ…å«ä¸€äº›æˆ‘ä»¬ä¸å¿…è¦çš„æ¥å£ä¿¡æ¯å’Œå†—ä½™ä»£ç ï¼Œ æ‰€ä»¥ pont ç»™æˆ‘ä»¬æä¾›äº†è¿‡æ»¤ swagger æ¨¡ç‰ˆæ•°æ®çš„ api transformPathï¼Œæˆ‘ä»¬é€šè¿‡è¿™ä¸ªé…ç½® export ä¸€ä¸ªè‡ªå®šä¹‰å¤„ç†æ•°æ®çš„æ–¹æ³•æ¥å®Œæˆæˆ‘ä»¬çš„è‡ªå®šä¹‰æ“ä½œã€‚è¿™æ ·å°±å¯ä»¥æŒ‰æˆ‘ä»¬çš„æ„æ„¿æ¥é€‰æ‹©æƒ³è¦çš„æ¨¡å—ã€‚

modï¼ŒæŒ‡çš„æ˜¯æ¥å£æ¨¡å—ï¼Œä¸€ä¸ª mod ä¸‹å¯ä»¥æœ‰Nä¸ªæ¥å£ï¼Œä¸€èˆ¬å¯¹åº”çš„æ˜¯åç«¯çš„æ§åˆ¶å™¨ã€‚

<a name="nv5qz"></a>
#### transformPath

`transformPath.ts` æ·»åŠ ä¸‹é¢çš„ä»£ç ï¼Œå†é…ç½®è‡ªå·±æƒ³è¦çš„æ¥å£æ¨¡å—ï¼Œä¹Ÿå¯ä»¥ä¸åŠ é»˜è®¤å¯¼å‡ºå…¨éƒ¨ï¼Œå¦‚æœä¸åŠ  é…ç½®æ–‡ä»¶ `transformPath`å­—æ®µç•™ç©ºå³å¯ã€‚

```javascript
// transfrom.ts æ ¹æ® Mod.nameè¿›è¡Œè¿‡æ»¤
import { StandardDataSource } from 'pont-engine'
const useMods = ['æ¨¡å—A', 'æ¨¡å—B', 'æ¨¡å—B']

// ä»åŸæ•°æ®ä¸­è¿‡æ»¤æˆ‘ä»¬æ‰€éœ€è¦çš„æ¥å£æ¨¡å—
export default function transform(data: StandardDataSource) {
  // å–åˆ°æ‰€éœ€è¦çš„ mods å’Œ baseClass
  const { mods, baseClasses } = filterModsAndBaseClass(useMods, data)
  data.mods = mods
  data.baseClasses = baseClasses
  // è¿”å›ç»™ pontï¼Œå®ƒå°†åªä¼šå¤„ç†è¿™äº›æ¨¡å—æ•°æ®
  return data
}

/**
 * è¿‡æ»¤modåŠæ‰€ä¾èµ–çš„baseClass
 * @param filterMods Mod.nameæ•°ç»„
 * @param data StandardDataSource
 */
function filterModsAndBaseClass(filterMods: string[], data: StandardDataSource) {
  const mods = data.mods.filter(mod => {
    const pickOne = filterMods.includes(mod.name)
    pickOne && console.log('æ¨¡å—: ' + mod.name)
    return pickOne
  })
  // è·å–æ‰€æœ‰ typeName (å®ä½“çš„åç§°)
  let typeNames = JSON.stringify(mods).match(/"typeName":".+?"/g)

  typeNames = Array.from(new Set(typeNames)) // å»é‡
    // å–typeNameçš„å€¼
    .map(item => item.split(':')[1].replace(/"/g, ''))

  // è¿‡æ»¤ baseClasses (æ ¹æ®å®ä½“åç§°ç”Ÿæˆbaseclass)
  const baseClasses = data.baseClasses.filter(cls => typeNames && typeNames.includes(cls.name))

  return { mods, baseClasses }
}
```

<a name="ppLbb"></a>
###  è‡ªå®šä¹‰ç”Ÿæˆå±äºè‡ªå·±çš„æ¥å£å°è£…

åœ¨æ¯ä¸ªäººçš„é¡¹ç›®å®è·µä¸­éƒ½ä¼šæ ¹æ®è‡ªå·±çš„ä¸šåŠ¡éœ€è¦å»å°è£…è‡ªå·±çš„ http æ¥å£è¯·æ±‚ï¼Œæ¯”å¦‚å¸¸è§çš„ axio å’Œ fetchã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°†æŒ‰ç…§ä¸Šæ–‡ å‰è¨€ ä¸­æåˆ°çš„å°è£…æ¥ç”Ÿæˆæ¥å£ä»£ç ã€‚

åˆ†æä¸€ä¸‹ ä¸‹é¢è¿™ä¸ªä»£ç ç‰‡æ®µæˆ‘ä»¬éœ€è¦ç”Ÿæˆé‚£äº›éƒ¨åˆ†æ‰èƒ½ç»„æˆä¸€ä¸ª å®Œæ•´çš„æ¥å£å°è£…

   1. éœ€è¦å®šä¹‰ä¸€ä¸ªæ–¹æ³•å…¥å‚çš„æ¥å£ç±»å‹ `getPageParams`
   2. éœ€è¦å®šä¹‰ä¸€ä¸ª api è¿”å›çš„æ•°æ®æ ¼å¼æ¥å£ `Item`
   3. ä¸€ä¸ªæ–¹æ³•å `getPage` å‚æ•°å `getPageParams` 
   4. æ¥å£è¯·æ±‚ç±»å‹ `post` æ¥å£è·¯å¾„ `/api/getpage`

```typescript
interface getPageParams {
  page: number
  size: number
}
interface Item {
  id: number
  title: string
}
// éœ€è¦ä¸€ä¸ªæ–¹æ³•å å‚æ•°å
export function getPage(data: getPageParams) {
  return post<Item[], getPageParams>('/api/getpage', data)
}
```

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™6ä¸ªå­—æ®µæ˜¯æˆ‘ä»¬å¸Œæœ›å®ƒèƒ½å¤Ÿå¸®æˆ‘ä»¬è‡ªåŠ¨çš„ç”Ÿæˆçš„ï¼Œå¦‚å„ç§æ–¹æ³•åï¼Œå…¥å‚å’Œè¿”å›ç»“æœã€‚è¿™æ ·å°±å¯ä»¥æ ¹æ®ä¸åŒçš„æ¥å£æ¥ç”Ÿæˆä¸åŒçš„ä»£ç å°è£…ä»£ç ï¼Œç„¶åå†å°†ä»–ä»¬æŒ‰æ¨¡å—ä¸€ä¸ªä¸ªå†™å…¥åˆ°æˆ‘ä»¬é¡¹ç›®çš„ `src/api`ä¹‹ä¸­ï¼Œè¿™æ ·å°±å¾ˆå®Œç¾äº†

pont æä¾›çš„èƒ½åŠ›å°±æ˜¯é€šè¿‡é‡å†™ä»–ä»¬çš„ æ–¹æ³• æ¥å®ç°é«˜åº¦å®šåˆ¶åŒ–çš„éœ€æ±‚ï¼Œå¯ä»¥ç»™ä½ å®šä¹‰ä»£ç æ¨¡æ¿ä»¥åŠè¾“å‡ºçš„æ–‡ä»¶ç›®å½•ç»“æ„ã€‚ä»¥ä¸‹æ˜¯æˆ‘ä»¬ä½¿ç”¨åˆ° apiï¼Œpont ç»™æˆ‘ä»¬æä¾›äº†å¾ˆå¤šåŠŸèƒ½ å¤§å®¶å¯ä»¥å»çœ‹çœ‹æ–‡æ¡£ï¼Œä¸‹é¢æ˜¯å®˜æ–¹ä»‹ç»ã€‚

ä»£ç ç”Ÿæˆå™¨ï¼š pont å°†å³åˆ»ç”Ÿæˆä¸€ä»½é»˜è®¤çš„è‡ªå®šä¹‰ä»£ç ç”Ÿæˆå™¨ã€‚é€šè¿‡è¦†ç›–é»˜è®¤çš„ä»£ç ç”Ÿæˆå™¨ï¼Œæ¥è‡ªå®šä¹‰ç”Ÿæˆä»£ç ã€‚é»˜è®¤çš„ä»£ç ç”Ÿæˆå™¨åŒ…å«ä¸¤ä¸ªç±»ï¼Œä¸€ä¸ªè´Ÿè´£ç®¡ç†ç›®å½•ç»“æ„ `FileStructures`ï¼Œä¸€ä¸ªè´Ÿè´£ç®¡ç†ç›®å½•ç»“æ„æ¯ä¸ªæ–‡ä»¶å¦‚ä½•ç”Ÿæˆä»£ç  `CodeGenerator`ã€‚è‡ªå®šä¹‰ä»£ç ç”Ÿæˆå™¨é€šè¿‡ç»§æ‰¿è¿™ä¸¤ä¸ªç±»ï¼Œè¦†ç›–å¯¹åº”çš„ä»£ç æ¥è¾¾åˆ°è‡ªå®šä¹‰çš„ç›®çš„ã€‚

```typescript
export class FileStructures extends Pont.FileStructures {
  /** è·å–æ¨¡å—çš„ç±»å‹å®šä¹‰ä»£ç , generator.hasContextBund ä¸ºtrueæ—¶è¦†ç›– generatorçš„åŒåæ–¹æ³• */
  getModsDeclaration(originCode: string, usingMultipleOrigins: boolean): string
  /** è·å–æ€»æ–‡ä»¶ç»“æ„  */
  getFileStructures(): FileStructure
}

export default class MyGenerator extends CodeGenerator {
  /** è·å–æ¥å£å®ç°å†…å®¹çš„ä»£ç  */
  getInterfaceContent(inter: Interface): string
  /** è·å–æ‰€æœ‰åŸºç±»æ–‡ä»¶ä»£ç  */
  getBaseClassesIndex(): string
  /** è·å–å•ä¸ªæ¨¡å—çš„ index å…¥å£æ–‡ä»¶ */
  getModIndex(mod: Mod): string
  /** è·å–æ‰€æœ‰æ¨¡å—çš„ index å…¥å£æ–‡ä»¶ */
  getModsIndex(): string
  /** è·å–æ¥å£ç±»å’ŒåŸºç±»çš„æ€»çš„ index å…¥å£æ–‡ä»¶ä»£ç  */
  getIndex(): string
}

```
<a name="tZq1f"></a>
#### CodeGenerator ç±»

1. getInterfaceContent

è¿™ä¸ªæ¥å£çš„å…¥å‚ä¸º Interfaceï¼ˆ[å»ºè®®çœ‹ä¸‹æºç å®šä¹‰](https://github.com/JayCJP/pont/blob/master/packages/pont-engine/src/standard.ts)ï¼‰ è¿™ä¸ªapiç»™æˆ‘ä»¬æä¾›äº†æ¥å£æ‰€æœ‰ç›¸å…³çš„ä¿¡æ¯ï¼Œä¹Ÿæ»¡è¶³æˆ‘ä»¬ä¸Šé¢æåˆ°çš„6ä¸ªå­—æ®µï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨å®ƒæ¥å®Œæˆæ¥å£è‡ªå®šä¹‰å°è£…ã€‚å°†å‚æ•°æ‹¼è£…æˆæˆ‘ä»¬æƒ³è¦çš„æ ·å­ã€‚

inter åº”ç”¨ä»‹ç»

```typescript
getInterfaceContent(inter: Interface): string

inter.description // æ¥å£æè¿°
inter.method // è¯·æ±‚ç±»å‹

// æ¥å£å‚æ•°ä»£ç å—
host // ä¸šåŠ¡åŸŸå
paramsCode = inter.getParamsCode(interfaceName) // get å‚æ•° querystring
inter.getBodyParamsCode() // post å‚æ•° body payload
inter.response // æè¿°æ¥å£çš„å“åº”ç±»å‹
inter.path // æ¥å£è·¯å¾„

// å–åˆ°æ¥å£ç”Ÿæˆçš„ è¿”å›å€¼ view model
const resultVo = formatResultVo(inter.response)
// æ ¼å¼åŒ–åè·å–åˆ° è¯·æ±‚å°è£…çš„å…¥å‚
const paramsCodeString = formatParameter(...)
// å°† paramsCode è½¬ä¸ºæ¥å£æ³¨é‡Š
const getParamsNoteList = getParamsNote(paramsCode)

// ç±»ä¼¼è¿™æ ·çš„æ‹¼è£…å³å®Œæˆäº†æ¥å£çš„è‡ªå®šä¹‰å°è£…
export function ${inter.name}(${paramsCodeString}) {
  return ${method}<${resultVo}, ${bodyParamsCode}>(
    ${host}${inter.path}(data, config)
  )
}

// æˆ‘ä»¬æƒ³è¦çš„æ ¼å¼æ¨¡æ¿
// export function getPage(data: getPageParams) {
//   return post<Item[], getPageParams>('/api/getpage', data)
// }
```

2. getModIndex

pont åœ¨è¾“å‡ºæ–‡ä»¶çš„æ—¶å€™ï¼Œä¼šæŒ‰ç…§ä¸€ä¸ªæ¥å£ç”Ÿæˆä¸€ä¸ª ts æ–‡ä»¶ï¼Œè¿™æ ·æ¥å£ä¸€å¤šå°±ä¼šç”Ÿæˆå¾ˆå¤šçš„ç‹¬ç«‹æ–‡ä»¶ã€‚ä¸ºäº†é¿å…æ¥å£æ–‡ä»¶å¤ªå¤šå½±å“ç¼–è¯‘æ‰“åŒ…é€Ÿåº¦çš„é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸€æ­¥å°†æ‰€æœ‰æ¥å£ç”Ÿæˆåˆ°ä¸€ä¸ª index.ts æ–‡ä»¶ä¸­ï¼Œå°±å¯ä»¥è¾¾åˆ°ä¼˜åŒ–çš„ç›®çš„ã€‚ è¿™é‡Œçš„æ–¹æ³•å…¥å‚ä¸ºä¸€ä¸ªæ¥å£æ¨¡å—ï¼Œå¯ä»¥åœ¨è¿™ä¸ªæ¨¡å—ä¸­æ‹¿åˆ°æ‰€æœ‰çš„æ¥å£ï¼Œå†å°†ä»–ä»¬é›†åˆèµ·æ¥ï¼Œå…·ä½“å®ç°çœ‹ä¸‹é¢å®Œæ•´å®ç°ä»£ç 

3. getModsIndex

å°†æ‰€æœ‰çš„æ¥å£æ¨¡å— ä¸€èµ·å¯¼å…¥åˆ°ä¸€ä¸ª index.ts å†å¯¼å‡ºä¸ºä¸€ä¸ªæ¨¡å—<br />å…·ä½“å®ç°çœ‹ä¸‹é¢å®Œæ•´å®ç°ä»£ç 

```typescript
import * as common from './common'
import * as user './user'
export default { common, user }
```

4. getIndex

è¿™ä¸€æ­¥æ“ä½œæˆ‘ä»¬å°†æ‰€æœ‰çš„æ¥å£æ¨¡å—å’Œæ¥å£å®šä¹‰å£°æ˜åˆå¹¶å¯¼å‡ºã€‚å¦‚æœæƒ³è¦ç»‘å®šåˆ°å…¨å±€ï¼Œå¯ä»¥ç›´æ¥ import è¿™ä¸ªæ–‡ä»¶å…·ä½“å®ç°çœ‹ä¸‹é¢å®Œæ•´å®ç°ä»£ç 

```typescript
import * as defs from './baseClass'
import mods from './mods/'
export { defs, mods }
```

5. getBaseClassesIndex

è¿™é‡Œä¸»è¦æ˜¯å¤„ç† baseclass ä¸­ number ç±»å‹çš„å…¼å®¹ï¼ˆè¸©å‘è®°å½•ç¬¬äºŒæ¡ï¼‰

ä¸‹é¢è¯·çœ‹æ¥å£çš„å®Œæ•´å®ç°ä»£ç 

```typescript
import { CodeGenerator, Interface, Mod, StandardDataType } from 'pont-engine'

export default class MyGenerator extends CodeGenerator {
  getInterfaceContent(inter: Interface) {
    // ä¼˜åŒ–å‚æ•°å
    // å®šä¹‰å‚æ•°æ¥å£ç±»å‹åç§°
    const interfaceName = `${inter.name}Params`
    // è·å– get è¯·æ±‚ï¼Œæ¥å£å£°æ˜çš„å†…å®¹å­—æ®µ -> æŒ‡å®šæ¥å£åç§° ç”Ÿæˆä»£ç å—
    const paramsCode = inter.getParamsCode(interfaceName)
    // è·å– post è¯·æ±‚ï¼Œå…¥å‚çš„å®ä½“ -> ä»£ç å—
    const bodyParamsCode = inter.getBodyParamsCode()
    // è¯·æ±‚æ–¹æ³•
    const method = inter.method.toLowerCase() as MethodType
    // åˆ¤æ–­æ¥å£æ˜¯å¦éœ€è¦è¯·æ±‚å‚æ•°
    const hasGetParams = !paramsCode.replace(/\n| /g, '').includes('{}')
    const host = '`${exhibit}'
    const po = '`'

    // å°† class å®šä¹‰ è½¬ä¸ºæ¥å£å£°æ˜ï¼ˆå±äºå¼ºè¿«ç—‡è¡Œä¸ºï¼‰
    const funcParams = paramsCode.replace(/class /, `interface `)
    // æ ¼å¼åŒ–åè·å–åˆ° è¯·æ±‚å°è£…çš„å…¥å‚
    const paramsCodeString = formatParameter(method, hasGetParams, interfaceName, bodyParamsCode)

    // å–åˆ°æ¥å£ç”Ÿæˆçš„ è¿”å›å€¼ view model
    const resultVo = formatResultVo(inter.response)

    // æ ¹æ®å…¥å‚å®šä¹‰ä¼ å‚çš„æ ¼å¼ï¼ˆå°è£…å¥½çš„ get post è¯·æ±‚ï¼‰
    let totalParams = ''
    // éœ€è¦æºå¸¦å‚æ•°
    if (paramsCodeString.length) {
      // åˆ¤æ–­æ˜¯å¦éœ€è¦ axios config é…ç½®
      if (paramsCodeString.includes('config')) {
        totalParams = ', data, config'
      } else {
        totalParams = ', data'
      }
    }
    const getParamsList = getParamsNote(paramsCode)
    // æ·»åŠ æ¥å£æ³¨é‡Š
    const note = `/**
  * @description ${inter.description}
  * @method ${method}
  ${getParamsList.join('\n')} 
  */`

    // è¿”å›æ•´ä½“çš„ä»£ç æ¨¡æ¿
    return `
    ${hasGetParams ? funcParams : ''}

    ${note}
    export function ${inter.name}(${paramsCodeString}) {
      return ${method}<${resultVo}, ${bodyParamsCode || (hasGetParams ? interfaceName : 'any')}>(
        ${host}${inter.path}${po}${totalParams}
      )
    }
    `
  }

  /** è·å–æ‰€æœ‰åŸºç±»æ–‡ä»¶ä»£ç  */
  getBaseClassesIndex() {
    const clsCodes = this.dataSource.baseClasses.map(base => {
      return `
        class ${base.name} {
          ${base.properties
            .map(prop => {
              const propValue = prop.toPropertyCodeWithInitValue(base.name)
              // ç”±äº pont æ²¡æœ‰å¯¹ number ç±»å‹è¿›è¡Œå¤„ç†ï¼Œåˆå§‹å€¼ç»™äº† undefined
              // æ‰€ä»¥è¿™é‡Œéœ€è¦å°†åŸºç±»å±æ€§ç±»å‹ä¸ºnumberçš„åˆå§‹å€¼ æ”¹ä¸º 0
              if (prop.dataType.typeName === 'number') {
                return propValue.replace(/undefined/g, '0')
              } else {
                return propValue
              }
            })
            .filter(id => id)
            .join('\n')}
        }
      `
    })

    if (this.dataSource.name) {
      return `
        ${clsCodes.join('\n')}
        export const ${this.dataSource.name} = {
          ${this.dataSource.baseClasses.map(bs => bs.name).join(',\n')}
        }
      `
    }

    return clsCodes.map(cls => `export ${cls}`).join('\n')
  }

  /** è·å–å•ä¸ªæ¨¡å—çš„ index å…¥å£æ–‡ä»¶ */
  getModIndex(mod: Mod) {
    const methods = new Set<string>()
    let importAxiosConfig = ''
    const modContent = `
      /**
       * @description ${mod.description}
       */
      ${mod.interfaces
        .map(inter => {
          methods.add(inter.method)
          // è·å– post è¯·æ±‚
          if (inter.method == 'post') {
            // æ¥å£å£°æ˜çš„å†…å®¹å­—æ®µ -> æŒ‡å®šæ¥å£åç§° ç”Ÿæˆä»£ç å—
            const paramsCode = inter.getParamsCode()
            // åˆ¤æ–­æ¥å£æ˜¯å¦éœ€è¦è¯·æ±‚å‚æ•°
            const hasGetParams = !paramsCode.replace(/\n| /g, '').includes('{}')
            if (hasGetParams) {
              importAxiosConfig = `import type { AxiosRequestConfig } from '@/types/axios'`
            }
          }
          return this.getInterfaceContent(inter)
        })
        .join('\n')}
    `

    return `
    ${importAxiosConfig}
    import { exhibit } from '@/utils/http/baseUrl'
    import { ${Array.from(methods)
      .map(type => {
        return type.toLowerCase()
      })
      .join(', ')} } from '@/utils/http'

    ${modContent}
    `
  }

  /** è·å–æ‰€æœ‰æ¨¡å—çš„ index å…¥å£æ–‡ä»¶ */
  getModsIndex() {
    const conclusion = `
      export default { ${this.dataSource.mods.map(mod => reviseModName(mod.name)).join(', \n')} }
    `
    return `
    ${this.dataSource.mods
      .map(mod => {
        const modName = reviseModName(mod.name)
        console.log('å¯¼å‡ºæ¥å£:' + modName)
        return `import * as ${modName} from './${modName}';`
      })
      .join('\n')}

      ${conclusion}
    `
  }

  /** è·å–æ¥å£ç±»å’ŒåŸºç±»çš„æ€»çš„ index å…¥å£æ–‡ä»¶ä»£ç  */
  getIndex() {
    let conclusion = `
      import * as defs from './baseClass';
      import mods from './mods/';

      export { defs, mods }
    `

    // dataSource name means multiple dataSource
    if (this.dataSource.name) {
      conclusion = `
        import { ${this.dataSource.name} as defs } from './baseClass';
        export { ${this.dataSource.name} } from './mods/';
        export { defs };
      `
    }

    return conclusion
  }
}
```

<a name="ptxaj"></a>
### è‡ªå®šä¹‰ç”Ÿæˆæ–‡ä»¶ç»“æ„ç›®å½•

<a name="PKgRo"></a>
#### FileStructures ç±»

1. getModsDeclaration

åœ¨ pont å®˜æ–¹çš„æ¨¡æ¿ä»£ç ä¸­ä¼š ç”Ÿæˆ `api.d.ts` çš„å£°æ˜æ–‡ä»¶ï¼Œä½†å…¶ä¸­åŒ…å«äº† `API` æ¥å£æ–¹æ³•çš„å®šä¹‰ï¼Œè¿™éƒ¨åˆ†æ˜¯æˆ‘ä»¬ä¸éœ€è¦çš„ï¼Œå› ä¸ºæˆ‘ä»¬é‡‡ç”¨è‡ªå·±ç”Ÿæˆçš„æ¨¡æ¿ï¼Œæ‰€ä»¥è¿™éƒ¨åˆ†åœ¨æˆ‘ä»¬è¿™é‡Œæ˜¯ä¸é€‚ç”¨ï¼Œæˆ‘ä»¬åªéœ€è¦å…¶ä¸­çš„  `defs` ç±»å‹çš„å®šä¹‰å³å¯ã€‚å› æ­¤æˆ‘ä»¬å°†é‡å†™è¿™ä¸ªæ–¹æ³• è®©å…¶è¿”å›ä¸€ä¸ªç©ºçš„å­—ç¬¦ä¸²

2. getFileStructures

pont åœ¨è¾“å‡ºæ–‡ä»¶çš„æ—¶å€™ï¼Œä¼šæŒ‰ç…§ä¸€ä¸ªæ¥å£ç”Ÿæˆä¸€ä¸ª ts æ–‡ä»¶ï¼Œå¦‚æœæ¥å£å‡ åä¸ªï¼Œè¿™å°†ä¼šç”Ÿæˆå‡ åä¸ªæ–‡ä»¶ï¼Œå¾ˆæ˜æ˜¾åœ¨è¿™ç‚¹ä¸Šä¼šå½±å“åˆ°æ‰“åŒ…å’Œç¼–è¯‘ ts çš„é€Ÿåº¦ã€‚æ‰€ä»¥æˆ‘ä»¬è¦å°† ä¸€ä¸ª mod ä¸‹é¢çš„æ‰€æœ‰æ¥å£ åˆæˆä¸€ä¸ª ts æ–‡ä»¶ï¼Œè¿™ä¸€æ­¥åœ¨ä¸Šé¢çš„ `getModIndex`ä¸­å·²ç»å®Œæˆï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è¿™ä¸ªåœ°æ–¹åªéœ€è¦åˆ›å»º index.ts å³å¯ï¼Œå…¶ä»–å¯ä»¥ä¸åˆ›å»º

```typescript
import * as Pont from 'pont-engine'

export class FileStructures extends Pont.FileStructures {
  /** è·å– index å†…å®¹ */
  getModsDeclaration(originCode: string, usingMultipleOrigins: boolean) {
    // ç”±äºæˆ‘ä»¬ä¸ä½¿ç”¨ pont çš„ requestæ¨¡æ¿ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬åªéœ€è¦å¯¼å‡ºæ¥å£çš„å®šä¹‰
    // API çš„å®šä¹‰å£°æ˜ï¼Œè¿™é‡Œä¸éœ€è¦æ‰€ä»¥è¿”å›ç©º
    if (usingMultipleOrigins) {
      return ''
    } else {
      return ''
    }
  }
  /** è·å–æ€»æ–‡ä»¶ç»“æ„   */
  getFileStructures() {
    // æ–‡ä»¶ç»“æ„
    const result = this.getOriginFileStructures(this.generators[0])
    // éå†æ‰€æœ‰mods
    for (const key in result.mods) {
      if (Object.prototype.hasOwnProperty.call(result.mods, key)) {
        const el = result.mods[key]
        // åªä¿ç•™ mods ä¸­çš„indexæ–‡ä»¶ï¼Œ åœ¨ getModIndex ä¸­å°†æ¥å£ä»£ç å†™å…¥åˆ°åŒä¸€ä¸ªæ–‡ä»¶
        if (el['index.ts']) {
          const newmod = {
            'index.ts': el['index.ts']
          }
          result.mods[key] = newmod
        }
      }
    }
    return result
  }
}
```
<a name="AM6ag"></a>
## è¸©å‘è®°å½•

<a name="Y4Nt1"></a>
### è‡ªå®šä¹‰ FileStructures 

åœ¨å®˜æ–¹çš„ [customizedPont.md](https://github.com/alibaba/pont/blob/master/docs/customizedPont.md) ä»‹ç»ä¸­ export ä¸€ä¸ª MyFileStructures å³å¯ é‡å†™ FileStructures çš„æ–¹æ³•ï¼Œä½†åœ¨ 1.3.3 çš„ç‰ˆæœ¬ä¸­å¹¶ä¸ç”Ÿæ•ˆ, é€šè¿‡æŸ¥çœ‹æºç å‘ç° Manager ç±»ä¸­çš„ setFilesManager å–å€¼æ˜¯ FileStructures å¹¶é  MyFileStructures æ‰€ä»¥ä¸‹é¢è¿™ä¸ªå†™æ³•æ˜¯é”™è¯¯çš„ å¥½å®¶ä¼™

```javascript
// pontTransfrom.ts  æ–‡æ¡£æ¨èå†™æ³• 
export class MyFileStructures extends FileStructures {}

// å®é™…æºç  manage.ts è§£æä»£ç æ—¶ ç»“æ„å–å€¼ä¸º FileStructures
setFilesManager() {
  this.report('æ–‡ä»¶ç”Ÿæˆå™¨åˆ›å»ºä¸­...')
  const { default: Generator, FileStructures: MyFileStructures } = getTemplate(
    this.currConfig.templatePath,
    this.currConfig.templateType
  )
  // å…¶ä»–æºç  .... 
}

```
æ›´æ­£å¦‚ä¸‹
```javascript
import * as Pont from 'pont-engine'
export class FileStructures extends Pont.FileStructures {}
```

<a name="LOivr"></a>
### baseclass ä¸­ number ç±»å‹çš„å­—æ®µåˆå§‹å€¼ä¸º undefined
ç»è¿‡æŸ¥æ‰¾æºç å‘ç° class StandardDataType->getInitialValue  è¿™ä¸ªæ–¹æ³•åœ¨ç”Ÿæˆ baseClass çš„ key 		value æ˜¯ï¼Œæ²¡æœ‰ç»™ number ç±»å‹çš„å±æ€§åšåˆå§‹å€¼å¤„ç†ï¼Œåˆå§‹å€¼ç»™äº† undefinedï¼Œ æ‰€ä»¥å‡ºç°åŸºç±»å±æ€§

åˆå§‹å€¼çš„ç±»å‹å’Œæ¥å£å®šä¹‰ api.d.ts çš„ç±» å±æ€§ç±»å‹ä¸ä¸€è‡´å¯¼è‡´ç±»å‹é”™è¯¯ã€‚
é€šè¿‡é‡å†™ ä¸‹é¢è¿™ä¸ªæ–¹æ³• çº æ­£è¿™ä¸ªç±»å‹é”™è¯¯

```typescript
/** è·å–æ‰€æœ‰åŸºç±»æ–‡ä»¶ä»£ç  */
getBaseClassesIndex() {}
```


<a name="DC9dr"></a>
## å®è·µä¸€ä¸‹

åœ¨ package.json ä¸­ æ·»åŠ ä¸€ä¸ª script 

```json
'script': {
   'apis': 'pont generate'
}
```

yarn apis -> pont ä¼šæ ¹æ®æˆ‘ä»¬é…ç½®çš„ä¿¡æ¯è‡ªåŠ¨ç”Ÿæˆ api ä¸‹èµ„æºæ–‡ä»¶
```
src
â”œâ”€api             #apiæ–‡ä»¶å¤¹
â”‚  â”œâ”€mods            #æ¨¡å—
â”‚  â”‚  â”œâ”€common          #å…¬å…±
â”‚  â”‚  â”œâ”€user            #ç”¨æˆ·
â”‚  â”‚  â””â”€index.ts        #é›†åˆæ‰€æœ‰æ¥å£
|  â”œâ”€baseClass.ts    #åŸºç±»
|  â”œâ”€api.d.ts        #æ¥å£å£°æ˜æ–‡ä»¶
â”‚  â””â”€index.ts        #é›†åˆå¯¼å‡ºåŸºç±»&æ¨¡å—&å£°æ˜
```

åœ¨ vue ä¸­æŒ‰éœ€å¼•ç”¨æ¥å£ å¦‚ä¸‹ç¤ºä¾‹:

```typescript
// user.vue
import { userVo } from '@/api/baseClass'
import { getDetail } from '@/api/mods/user'

const userInfo = reactive(new userVo())

function getUserDetail(id: number) {
  getDetail({ id })
    .then(res => {
        userInfo = res.data
    })
    .catch(error => {
      Message.error(error.msg)
    })
}
```
